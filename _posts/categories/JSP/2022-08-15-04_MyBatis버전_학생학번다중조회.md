categories:
- JAVA

# 04_MyBatisë²„ì „_í•™ìƒí•™ë²ˆë‹¤ì¤‘ì¡°íšŒ

ë¨¼ì €, í•™ìƒ í•™ë²ˆ ë‹¤ì¤‘ì¡°íšŒì— ëŒ€í•œ ì„¤ì •ì„ ì–´ë–»ê²Œ í•  ì§€ êµ¬ìƒí•©ë‹ˆë‹¤.

í•œ ì‚¬ëŒ ë§Œì„ ì…ë ¥ì„ ìš”êµ¬í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ì—¬ëŸ¬ ê°’ ì…ë ¥ì„ ìš”êµ¬í•˜ë¯€ë¡œ select íƒœê·¸ êµ¬ë¬¸ì—ì„œ foreach íƒœê·¸ êµ¬ë¬¸ì„ í†µí•´ ê°’ì„ ë„£ì–´ì¤˜ì•¼ í•  ê²ƒì…ë‹ˆë‹¤.

<aside>
ğŸ’¡ 1ï¸âƒ£ StudentMapper.xml ì‘ì—…í•˜ê¸°

</aside>

- StudentMapper.xml
    
```xml
<select id="selectBySearchNo" resultType="Student"
    	parameterType="arraylist">
    <![CDATA[
    	select student_no as stuNo, student_name as stuName,
    		RPAD(substr(student_ssn, 0, 8), 14, '*') as stuSsn, 
    		CASE WHEN student_address IS NULL THEN '***ì£¼ì†Œ ë¯¸ìƒ***'
    			 ELSE substr(student_address, 0, 10) || '...'
    		END as stuAddress,
    		to_char(entrance_date, 'yyyy/mm/dd') as entDate,
    		absence_yn as absYn
    	from tb_student
		where student_no IN
    ]]>
    	<foreach collection="list" item="item" open="(" separator="," close=")">
    	   #{item}
    	</foreach>
    <![CDATA[
    	order by student_no asc
    ]]>
    </select>
```
    

---

selectBySearchNo idê°’ì€ ê¸°ì–µí•´ë‘¡ë‹ˆë‹¤.

ì´ì œ idê°’ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ dao, service, serviceImpl ì‘ì—…ì„ í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡ 2ï¸âƒ£ MyBatisDAO.java ì‘ì—…í•˜ê¸°

</aside>

- MyBatisDAO.java
    
    ```java
    public List<StudentDTO> selectBySearchNo(SqlSession session, ArrayList<String> no) {
    		
    		return session.selectList("com.mybatis.student.StudentMapper.selectBySearchNo", no);
    	}
    ```
    

---

ëˆˆì—¬ê²¨ë´ì•¼ í•  ì ì€ ArrayListë¥¼ í†µí•´ searchNoì˜ ë¬¸ìì—´ì„ ë°°ì—´ì— ìƒì„±í•œë‹¤ëŠ” ì ì…ë‹ˆë‹¤.

ë‹¤ìŒìœ¼ë¡œ serviceì—ì„œ ì‘ì—…í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡ 3ï¸âƒ£ MyBatisService.java ì‘ì—…í•˜ê¸°

</aside>

- MyBatisService.java
    
    ```java
    //í•™ìƒ í•™ë²ˆ ë‹¤ì¤‘ ì¡°íšŒ
    	public List<StudentDTO> selectBySearchNo(String searchNo) throws Exception;
    ```
    

---

ì´ì œ ServiceImplì—ì„œ unimplemented methodë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

<aside>
ğŸ’¡ 4ï¸âƒ£ MyBatisServiceImpl.java ì‘ì—…í•˜ê¸°

</aside>

- MyBatisServiceImpl.java
    
    ```java
    @Override
    	public List<StudentDTO> selectBySearchNo(String searchNo)
    			throws Exception {
    		
    		String[] no = searchNo.split(",");
    		ArrayList<String> arr = new ArrayList<>();
    		
    		for (String x : no) {
    			arr.add(x);
    		}
    		
    		SqlSession session = MySqlSessionFactory.getSession();
    		List<StudentDTO> list = null;
    		
    	 	try{
    	 		//DAO ì—°ë™
    	 		list = dao.selectBySearchNo(session, arr);
    	 	}finally{
    	 		session.close();
    	 	}
    		
    		return list;
    	}//end selectBySearchNo()
    ```
    

---

ì—¬ê¸°ì„œëŠ” ì´ ë¶€ë¶„ì— ì§‘ì¤‘!

```java
String[] no = searchNo.split(",");
		ArrayList<String> arr = new ArrayList<>();
		
		for (String x : no) {
			arr.add(x);
}
```

- ArrayListë¥¼ í†µí•˜ì—¬ arr ë°°ì—´ì„ ìƒì„±í•˜ê³  ê·¸ ë°°ì—´ì•ˆì— êµ¬ë¶„ì â€œ,â€ë¡œ ë‚˜ëˆˆ no ë°°ì—´ì— foreachêµ¬ë¬¸ìœ¼ë¡œ ë©”ì„œë“œ addë¡œ ë„£ì–´ì¤ë‹ˆë‹¤.

ë§ˆì§€ë§‰ìœ¼ë¡œ ë©”ì¸ì„ ê±´ë“œë¦¬ë©´ ë©ë‹ˆë‹¤.

<aside>
ğŸ’¡ 5ï¸âƒ£ MyBatisMain.java ì‘ì—…í•˜ê¸°

</aside>

case4, printë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

- MyBatisMain.java
    
    ```java
    import java.util.HashMap;
    import java.util.List;
    import java.util.Scanner;
    
    import com.dto.StudentDTO;
    import com.service.MyBatisService;
    import com.service.MyBatisServiceImpl;
    
    public class MyBatisMain {
    
    	public static void main(String[] args) {
    		
    		Scanner scan = new Scanner(System.in);
    		while(true) {
    			printMainMenu();
    			int num = scan.nextInt();
    			
    			switch (num) {
    			
    			case 1: printSelectAllStudent();
    				break;
    			case 2: {
    				System.out.println("ê²€ìƒ‰í•  í•™ìƒëª…ì„ ì…ë ¥í•˜ì‹œì˜¤ =>");
    				String searchName = scan.next();
    				printSearchName(searchName);
    			}
    				break;
    			case 3: {
    				System.out.println("ì‹œì‘ ì…í•™ë…„ë„ ì…ë ¥í•˜ì‹œì˜¤ =>");
    				String startYear = scan.next();
    				System.out.println("ë ì…í•™ë…„ë„ ì…ë ¥í•˜ì‹œì˜¤ =>");
    				String endYear = scan.next();
    				printSearchEntranceDate(startYear, endYear);
    				
    			}
    				break;
    			case 4: {
    				System.out.println("ê²€ìƒ‰í•  í•™ìƒì˜ í•™ë²ˆì„ ì…ë ¥í•˜ì‹œì˜¤ =>");
    				String searchNo = scan.next();
    				printSearchNo(searchNo);
    				
    			}
    				break;
    			case 0: exit();
    				break;
    			}
    			
    		}//end while
    	}//end main
    	
    	private static void printSearchNo(String searchNo) {
    		MyBatisService service = new MyBatisServiceImpl();
    		
    		List<StudentDTO> list = null;
    		try {
    			list = service.selectBySearchNo(searchNo);
    		} catch (Exception e) {
    			e.printStackTrace();
    		}
    		
    		System.out.println("================================================================================");
    		System.out.println("í•™ë²ˆ\tì´ë¦„\tì£¼ë¯¼ë²ˆí˜¸\t\tì£¼ì†Œ\t\t\tì…í•™ë…„ë„\t\tíœ´í•™ì—¬ë¶€");
    		System.out.println("--------------------------------------------------------------------------------");
    		
    		for (StudentDTO dto : list) {
    			System.out.printf("%s\t%s\t%s\t%s\t%s\t%s\t\n", dto.getStuNo(), dto.getStuName(), dto.getStuSsn(),
    					dto.getStuAddress(), dto.getEntDate(), dto.getAbsYn());
    		}
    		
    		System.out.printf("ì´ í•™ìƒìˆ˜: %d ëª…\n", list.size());
    		
    	}
    	
    	private static void printSearchEntranceDate(String startYear, String endYear) {
    		MyBatisService service = new MyBatisServiceImpl();
    		HashMap<String, String> map = new HashMap<String, String>();
    		map.put("startYear", startYear);
    		map.put("endYear", endYear);
    		
    		List<StudentDTO> list = null;
    		try {
    			list = service.selectByEntranceDate(map);
    		} catch (Exception e) {
    			e.printStackTrace();
    		}
    		
    		System.out.println("================================================================================");
    		System.out.println("í•™ë²ˆ\tì´ë¦„\tì£¼ë¯¼ë²ˆí˜¸\t\tì£¼ì†Œ\t\t\tì…í•™ë…„ë„\t\tíœ´í•™ì—¬ë¶€");
    		System.out.println("--------------------------------------------------------------------------------");
    		
    		for (StudentDTO dto : list) {
    			System.out.printf("%s\t%s\t%s\t%s\t%s\t%s\t\n", dto.getStuNo(), dto.getStuName(), dto.getStuSsn(),
    					dto.getStuAddress(), dto.getEntDate(), dto.getAbsYn());
    		}
    		
    		System.out.printf("ì´ í•™ìƒìˆ˜: %d ëª…\n", list.size());
    		
    	}
    	
    	private static void printSearchName(String searchName) {
    		MyBatisService service = new MyBatisServiceImpl();
    		List<StudentDTO> list = null;
    		try {
    			list = service.selectByName(searchName);
    		} catch (Exception e) {
    			e.printStackTrace();
    		}
    		
    		System.out.println("================================================================================");
    		System.out.println("í•™ë²ˆ\tì´ë¦„\tì£¼ë¯¼ë²ˆí˜¸\t\tì£¼ì†Œ\t\t\tì…í•™ë…„ë„\t\tíœ´í•™ì—¬ë¶€");
    		System.out.println("--------------------------------------------------------------------------------");
    		
    		for (StudentDTO dto : list) {
    			System.out.printf("%s\t%s\t%s\t%s\t%s\t%s\t\n", dto.getStuNo(), dto.getStuName(), dto.getStuSsn(),
    					dto.getStuAddress(), dto.getEntDate(), dto.getAbsYn());
    		}
    		
    		System.out.printf("ì´ í•™ìƒìˆ˜: %d ëª…\n", list.size());
    		
    	}
    	
    	private static void exit() {
    		System.out.println("í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
    		System.exit(0);
    	}
    	
    	private static void printSelectAllStudent() {
    		MyBatisService service = new MyBatisServiceImpl();
    		List<StudentDTO> list = null;
    		try {
    			list = service.selectAllStudent();
    		} catch (Exception e) {
    			e.printStackTrace();
    		}
    		
    		System.out.println("================================================================================");
    		System.out.println("í•™ë²ˆ\tì´ë¦„\tì£¼ë¯¼ë²ˆí˜¸\t\tì£¼ì†Œ\t\t\tì…í•™ë…„ë„\t\tíœ´í•™ì—¬ë¶€");
    		System.out.println("--------------------------------------------------------------------------------");
    		
    		for (StudentDTO dto : list) {
    			System.out.printf("%s\t%s\t%s\t%s\t%s\t%s\t\n", dto.getStuNo(), dto.getStuName(), dto.getStuSsn(),
    					dto.getStuAddress(), dto.getEntDate(), dto.getAbsYn());
    		}
    		
    		System.out.printf("ì´ í•™ìƒìˆ˜: %d ëª…\n", list.size());
    		
    	}
    	
    	private static void printMainMenu() {
    		System.out.println("***************************************");
    		System.out.println("	[í•™ìƒ ì •ë³´ ê´€ë¦¬ ë©”ë‰´]		");
    		System.out.println("***************************************");
    		System.out.println("1.ì „ì²´ í•™ìƒ ëª©ë¡");
    		System.out.println("2.í•™ìƒ ì´ë¦„ ê²€ìƒ‰");
    		System.out.println("3.í•™ìƒ ì…í•™ë…„ë„ ë²”ìœ„ ê²€ìƒ‰ (ì˜ˆ> 2000ë…„ë¶€í„° 2003ë…„ê¹Œì§€)");
    		System.out.println("4.í•™ìƒ í•™ë²ˆìœ¼ë¡œ ë‹¤ì¤‘ ê²€ìƒ‰ (ì‰¼í‘œ êµ¬ë¶„ì)");
    		System.out.println("0.ì¢…ë£Œ");
    		System.out.println("***************************************");
    		System.out.println("ë©”ë‰´ ì…ë ¥ => ");
    	}
    	
    	
    }//end class
    ```
    

---
<h1>ì‹¤í–‰ê²°ê³¼</h1>

![image](https://user-images.githubusercontent.com/111172834/184618099-1910e4fe-4660-40ea-bdac-e588419d9515.png)

![image2](https://user-images.githubusercontent.com/111172834/184618492-b88a43b2-b96a-4901-b8c5-7b5875039bee.png)